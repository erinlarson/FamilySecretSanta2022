Flyson/Flynn/Golde/Kowalsky Secret Santa 2022
================
Erin Larson
2022-11-22

Note: this code was modified from:
<https://github.com/tjmahr/tjmahr.github.io/blob/master/_R/2017-11-28-secret-santa-graph-traversal.Rmd>

# R set up

Bringing in relevant packages.

``` r
knitr::opts_chunk$set(echo = TRUE)
library(DiagrammeR)
library(magrittr)
library(dplyr, warn.conflicts = FALSE)
```

# Nibling set up

Creating table of names and family relations.

``` r
niblings <- tibble::tribble(
      ~Family, ~ Name, ~ Number,
    "Flyson", "Tom",        1,
      "Flyson",  "Erin",        2, 
 "Flynn", "Ryan",        3, 
   "Flynn",   "Alli",        4, 
   "Golwalsky", "Gae",        5,
 "Golwalsky", "Tim", 6
)
```

# Graph Rendering

Function to show gift giving network.

``` r
render_graph <- function(graph, height = 300, ...) {
  g <- DiagrammeR::render_graph(graph, height = height, ...)
  
  svg_dim <- sprintf("svg width=\"%s\" height=\"%s\"", "100%", height)
  
  DiagrammeRsvg::export_svg(g) %>% 
    stringr::str_replace("^<[?]xml.+\n", "") %>%
    stringr::str_replace("^<[!]DOCTYPE.+\n.+\n", "") %>%
    stringr::str_replace("svg width=\"\\d+pt\" height=\"\\d+pt\"", 
                         svg_dim) %>%
    htmltools::HTML() %>%
    knitr::asis_output()
}
if (interactive()) render_graph <- DiagrammeR::render_graph
```

# Example

Quick example showing what it would look like if Erin drew Gae from a
“hat”.

``` r
nodes <- create_node_df(
  n = nrow(niblings),
  type = niblings$Name,
  label = niblings$Name
)
erin_drew_gae <- create_edge_df(
  from = 2, 
  to = 5, 
  rel = "gives-to",
  color = "#FF4136",
  penwidth = 1
)
create_graph(nodes, erin_drew_gae) %>% 
  render_graph()
```

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %0 Pages: 1 -->
<svg width="100%" height="300" viewBox="0.00 0.00 212.00 177.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 173)">
<title>
%0
</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-173 208,-173 208,4 -4,4"/>
<!-- 2&#45;&gt;5 --> <g id="edge1" class="edge">
<title>
2-\>5
</title>
<path fill="none" stroke="#ff4136" d="M36.1196,-87.2515C54.2595,-84.5413 82.2301,-80.3623 101.9008,-77.4234"/>
<polygon fill="#ff4136" stroke="#ff4136" points="102.2759,-79.1369 106.9624,-76.6672 101.7587,-75.6753 102.2759,-79.1369"/>
</g> <!-- 1 --> <g id="node1" class="node">
<title>
1
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="123" cy="-137" rx="18" ry="18"/>
<text text-anchor="middle" x="123" y="-134" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Tom</text>
</g> <!-- 2 --> <g id="node2" class="node">
<title>
2
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="18" cy="-89.9587" rx="18" ry="18"/>
<text text-anchor="middle" x="18" y="-86.9587" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Erin</text>
</g> <!-- 3 --> <g id="node3" class="node">
<title>
3
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="60" cy="-151" rx="18" ry="18"/>
<text text-anchor="middle" x="60" y="-148" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Ryan</text>
</g> <!-- 4 --> <g id="node4" class="node">
<title>
4
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="18" cy="-32" rx="18" ry="18"/>
<text text-anchor="middle" x="18" y="-29" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Alli</text>
</g> <!-- 5 --> <g id="node5" class="node">
<title>
5
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="124.8144" cy="-74" rx="18" ry="18"/>
<text text-anchor="middle" x="124.8144" y="-71" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Gae</text>
</g> <!-- 6 --> <g id="node6" class="node">
<title>
6
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="186" cy="-18" rx="18" ry="18"/>
<text text-anchor="middle" x="186" y="-15" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Tim</text>
</g> </g>
</svg>

# All possible connections

Creating a graph showing all possible gift-giving connections.

``` r
combn(niblings$Name, 2)
```

    ##      [,1]   [,2]   [,3]   [,4]  [,5]  [,6]   [,7]   [,8]   [,9]   [,10]  [,11] 
    ## [1,] "Tom"  "Tom"  "Tom"  "Tom" "Tom" "Erin" "Erin" "Erin" "Erin" "Ryan" "Ryan"
    ## [2,] "Erin" "Ryan" "Alli" "Gae" "Tim" "Ryan" "Alli" "Gae"  "Tim"  "Alli" "Gae" 
    ##      [,12]  [,13]  [,14]  [,15]
    ## [1,] "Ryan" "Alli" "Alli" "Gae"
    ## [2,] "Tim"  "Gae"  "Tim"  "Tim"

``` r
# All the edge-manipulating functions in this post take an optional take `...`
# argument for setting the style of edges.
create_all_giving_edges <- function(xs, ...) {
  aes_options <- quos(...)
  pairs <- combn(seq_along(xs), 2)
  # Each column from `combn()` is a pair. We make an edge moving down the column
  # and another edge up the column by having each row as a `from` index and a
  # `to` index.
  from <- c(pairs[1, ], pairs[2, ])
  to <- c(pairs[2, ], pairs[1, ])
  create_edge_df(from = from, to = to) %>% 
    mutate(!!! aes_options) %>% 
    as_tibble()
}
all_possible_edges <- create_all_giving_edges(
  niblings$Name, 
  rel = "potential-gift", 
  penwidth = .5,
  color = "#CCCCCC90"
)
create_graph(nodes, all_possible_edges) %>% 
  render_graph()
```

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %0 Pages: 1 -->
<svg width="100%" height="300" viewBox="0.00 0.00 162.67 178.47" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 174.4709)">
<title>
%0
</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-174.4709 158.6742,-174.4709 158.6742,4 -4,4"/>
<!-- 1&#45;&gt;2 --> <g id="edge1" class="edge">
<title>
1-\>2
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M37.1857,-54.5233C57.4697,-57.5711 91.2,-59.1798 113.6839,-58.2929"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="113.9567,-60.0314 118.8618,-58.0309 113.7797,-56.5359 113.9567,-60.0314"/>
</g> <!-- 1&#45;&gt;3 --> <g id="edge2" class="edge">
<title>
1-\>3
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M37.7681,-46.3207C45.6365,-43.2615 54.822,-38.718 62.6197,-34.0797"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="63.9465,-35.3159 67.2714,-31.1918 62.1004,-32.3423 63.9465,-35.3159"/>
</g> <!-- 1&#45;&gt;4 --> <g id="edge3" class="edge">
<title>
1-\>4
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M23.7023,-66.8622C31.2357,-85.9239 46.5941,-115.6801 58.5581,-134.6481"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="57.3342,-135.978 61.5199,-139.225 60.2726,-134.0765 57.3342,-135.978"/>
</g> <!-- 1&#45;&gt;5 --> <g id="edge4" class="edge">
<title>
1-\>5
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M32.2456,-62.2129C51.3165,-77.2894 87.991,-100.7241 111.6386,-113.1005"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="110.9365,-114.7069 116.1854,-115.4226 112.5284,-111.5899 110.9365,-114.7069"/>
</g> <!-- 1&#45;&gt;6 --> <g id="edge5" class="edge">
<title>
1-\>6
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M13.4393,-65.873C12.3679,-74.0654 11.9354,-83.9986 12.223,-92.8387"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="10.4928,-93.2722 12.4959,-98.1763 13.9882,-93.0935 10.4928,-93.2722"/>
</g> <!-- 2&#45;&gt;1 --> <g id="edge16" class="edge">
<title>
2-\>1
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M119.4078,-48.0675C99.1239,-45.0197 65.3935,-43.411 42.9097,-44.2979"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="42.6369,-42.5594 37.7317,-44.5599 42.8138,-46.0549 42.6369,-42.5594"/>
</g> <!-- 2&#45;&gt;3 --> <g id="edge6" class="edge">
<title>
2-\>3
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M125.2392,-39.5094C118.6145,-34.331 110.1057,-28.8046 102.2305,-24.517"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="102.675,-22.7757 97.4315,-22.0216 101.0603,-25.881 102.675,-22.7757"/>
</g> <!-- 2&#45;&gt;4 --> <g id="edge7" class="edge">
<title>
2-\>4
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M122.9352,-66.0965C110.157,-82.2119 91.9962,-110.5476 81.5922,-130.3954"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="79.9593,-129.7454 79.2463,-134.9947 83.0772,-131.3358 79.9593,-129.7454"/>
</g> <!-- 2&#45;&gt;5 --> <g id="edge8" class="edge">
<title>
2-\>5
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M129.896,-70.7856C128.6506,-79.18 128.0446,-89.4189 128.2188,-98.4447"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="126.4758,-98.6652 128.4127,-103.5958 129.9733,-98.5335 126.4758,-98.6652"/>
</g> <!-- 2&#45;&gt;6 --> <g id="edge9" class="edge">
<title>
2-\>6
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M118.9695,-57.7018C96.4791,-66.6006 58.0262,-86.5041 35.5918,-100.7107"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="34.5742,-99.2848 31.328,-103.4712 36.4763,-102.2229 34.5742,-99.2848"/>
</g> <!-- 3&#45;&gt;1 --> <g id="edge17" class="edge">
<title>
3-\>1
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M62.0247,-20.4768C54.1563,-23.536 44.9709,-28.0794 37.1731,-32.7178"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="35.8463,-31.4816 32.5214,-35.6057 37.6924,-34.4552 35.8463,-31.4816"/>
</g> <!-- 3&#45;&gt;2 --> <g id="edge21" class="edge">
<title>
3-\>2
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M91.3086,-32.2839C97.9332,-37.4623 106.4421,-42.9887 114.3173,-47.2763"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="113.8728,-49.0176 119.1163,-49.7717 115.4875,-45.9123 113.8728,-49.0176"/>
</g> <!-- 3&#45;&gt;4 --> <g id="edge10" class="edge">
<title>
3-\>4
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M74.3871,-35.3755C70.8222,-59.4271 68.7854,-102.9088 69.8425,-129.5827"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="68.0998,-129.7755 70.0956,-134.6826 71.5955,-129.602 68.0998,-129.7755"/>
</g> <!-- 3&#45;&gt;5 --> <g id="edge11" class="edge">
<title>
3-\>5
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M83.5903,-35.9392C91.0477,-54.857 106.2814,-84.3767 118.1622,-103.1871"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="116.9157,-104.4816 121.1037,-107.7257 119.8528,-102.578 116.9157,-104.4816"/>
</g> <!-- 3&#45;&gt;6 --> <g id="edge12" class="edge">
<title>
3-\>6
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M66.2433,-30.1703C53.6463,-46.0616 35.7958,-73.9666 25.5128,-93.6264"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="23.7745,-93.1843 23.0694,-98.4346 26.8947,-94.77 23.7745,-93.1843"/>
</g> <!-- 4&#45;&gt;1 --> <g id="edge18" class="edge">
<title>
4-\>1
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M70.2801,-134.4062C62.7467,-115.3445 47.3884,-85.5883 35.4243,-66.6203"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="36.6482,-65.2904 32.4626,-62.0434 33.7098,-67.1919 36.6482,-65.2904"/>
</g> <!-- 4&#45;&gt;2 --> <g id="edge22" class="edge">
<title>
4-\>2
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M87.8022,-140.1677C100.5803,-124.0524 118.7411,-95.7166 129.1452,-75.8688"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="130.7781,-76.5188 131.4911,-71.2696 127.6602,-74.9285 130.7781,-76.5188"/>
</g> <!-- 4&#45;&gt;3 --> <g id="edge25" class="edge">
<title>
4-\>3
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M79.5496,-135.0954C83.1145,-111.0438 85.1513,-67.5621 84.0942,-40.8882"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="85.8368,-40.6954 83.841,-35.7883 82.3411,-40.8689 85.8368,-40.6954"/>
</g> <!-- 4&#45;&gt;5 --> <g id="edge13" class="edge">
<title>
4-\>5
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M91.875,-149.7476C99.7,-146.5799 108.8211,-141.91 116.5534,-137.1644"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="117.8969,-138.3822 121.1644,-134.2125 116.0098,-135.4345 117.8969,-138.3822"/>
</g> <!-- 4&#45;&gt;6 --> <g id="edge14" class="edge">
<title>
4-\>6
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M62.9053,-138.0093C56.4853,-132.807 48.2475,-127.2376 40.5642,-122.854"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="41.1001,-121.1528 35.8731,-120.2918 39.4223,-124.2245 41.1001,-121.1528"/>
</g> <!-- 5&#45;&gt;1 --> <g id="edge19" class="edge">
<title>
5-\>1
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M121.2554,-107.4325C102.1845,-92.3559 65.51,-68.9212 41.8624,-56.5448"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="42.5645,-54.9384 37.3156,-54.2227 40.9726,-58.0554 42.5645,-54.9384"/>
</g> <!-- 5&#45;&gt;2 --> <g id="edge23" class="edge">
<title>
5-\>2
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M140.36,-103.8555C141.6053,-95.4612 142.2114,-85.2223 142.0371,-76.1964"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="143.7801,-75.976 141.8432,-71.0454 140.2826,-76.1077 143.7801,-75.976"/>
</g> <!-- 5&#45;&gt;3 --> <g id="edge26" class="edge">
<title>
5-\>3
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M129.8649,-102.9087C122.4075,-83.9909 107.1739,-54.4711 95.293,-35.6608"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="96.5395,-34.3662 92.3515,-31.1222 93.6024,-36.2698 96.5395,-34.3662"/>
</g> <!-- 5&#45;&gt;4 --> <g id="edge28" class="edge">
<title>
5-\>4
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M115.7698,-123.5712C107.9449,-126.7388 98.8238,-131.4087 91.0914,-136.1544"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="89.7479,-134.9366 86.4805,-139.1063 91.635,-137.8843 89.7479,-134.9366"/>
</g> <!-- 5&#45;&gt;6 --> <g id="edge15" class="edge">
<title>
5-\>6
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M116.2472,-115.0721C96.1131,-112.0297 62.8337,-110.414 40.6648,-111.2905"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="40.4645,-109.5483 35.5597,-111.5499 40.6421,-113.0438 40.4645,-109.5483"/>
</g> <!-- 6&#45;&gt;1 --> <g id="edge20" class="edge">
<title>
6-\>1
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M24.48,-98.6942C25.5514,-90.5018 25.9839,-80.5685 25.6963,-71.7285"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="27.4265,-71.295 25.4234,-66.3909 23.9311,-71.4737 27.4265,-71.295"/>
</g> <!-- 6&#45;&gt;2 --> <g id="edge24" class="edge">
<title>
6-\>2
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M35.7048,-111.8612C58.1952,-102.9624 96.648,-83.0589 119.0824,-68.8523"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="120.1001,-70.2782 123.3462,-66.0918 118.198,-67.3401 120.1001,-70.2782"/>
</g> <!-- 6&#45;&gt;3 --> <g id="edge27" class="edge">
<title>
6-\>3
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M31.6302,-103.5994C44.2272,-87.7081 62.0777,-59.8031 72.3607,-40.1433"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="74.099,-40.5854 74.8042,-35.3351 70.9788,-38.9997 74.099,-40.5854"/>
</g> <!-- 6&#45;&gt;4 --> <g id="edge29" class="edge">
<title>
6-\>4
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M29.1578,-130.2313C35.5778,-135.4336 43.8157,-141.003 51.499,-145.3865"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="50.9631,-147.0878 56.1901,-147.9488 52.6408,-144.0161 50.9631,-147.0878"/>
</g> <!-- 6&#45;&gt;5 --> <g id="edge30" class="edge">
<title>
6-\>5
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M35.3345,-121.5455C55.4686,-124.5878 88.748,-126.2036 110.9169,-125.327"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="111.1172,-127.0692 116.022,-125.0676 110.9396,-123.5737 111.1172,-127.0692"/>
</g> <!-- 1 --> <g id="node1" class="node">
<title>
1
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="19.9193" cy="-48.7975" rx="18" ry="18"/>
<text text-anchor="middle" x="19.9193" y="-45.7975" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Tom</text>
</g> <!-- 2 --> <g id="node2" class="node">
<title>
2
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="136.6742" cy="-53.7933" rx="18" ry="18"/>
<text text-anchor="middle" x="136.6742" y="-50.7933" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Erin</text>
</g> <!-- 3 --> <g id="node3" class="node">
<title>
3
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="79.8735" cy="-18" rx="18" ry="18"/>
<text text-anchor="middle" x="79.8735" y="-15" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Ryan</text>
</g> <!-- 4 --> <g id="node4" class="node">
<title>
4
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="74.0631" cy="-152.4709" rx="18" ry="18"/>
<text text-anchor="middle" x="74.0631" y="-149.4709" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Alli</text>
</g> <!-- 5 --> <g id="node5" class="node">
<title>
5
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="133.5817" cy="-120.8478" rx="18" ry="18"/>
<text text-anchor="middle" x="133.5817" y="-117.8478" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Gae</text>
</g> <!-- 6 --> <g id="node6" class="node">
<title>
6
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="18" cy="-115.7697" rx="18" ry="18"/>
<text text-anchor="middle" x="18" y="-112.7697" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Tim</text>
</g> </g>
</svg>

# Gift giving dataframe

Creating a table with all possible combinations of gift-giving.

``` r
nibling_edges <- niblings$Name %>% 
  create_all_giving_edges(
    rel = "potential-gift", 
    penwidth = .5,
    color = "#CCCCCC90"
  ) %>% 
  left_join(niblings, by = c("from" = "Number")) %>% 
  rename(from_fam = Family) %>% 
  select(-Name) %>% 
  left_join(niblings, by = c("to" = "Number")) %>% 
  rename(to_fam = Family) %>% 
  select(-Name) %>% 
  select(id, from, to, rel, from_fam, to_fam, everything())
nibling_edges
```

    ## # A tibble: 30 × 8
    ##       id  from    to rel            from_fam to_fam    penwidth color    
    ##    <int> <dbl> <dbl> <chr>          <chr>    <chr>        <dbl> <chr>    
    ##  1     1     1     2 potential-gift Flyson   Flyson         0.5 #CCCCCC90
    ##  2     2     1     3 potential-gift Flyson   Flynn          0.5 #CCCCCC90
    ##  3     3     1     4 potential-gift Flyson   Flynn          0.5 #CCCCCC90
    ##  4     4     1     5 potential-gift Flyson   Golwalsky      0.5 #CCCCCC90
    ##  5     5     1     6 potential-gift Flyson   Golwalsky      0.5 #CCCCCC90
    ##  6     6     2     3 potential-gift Flyson   Flynn          0.5 #CCCCCC90
    ##  7     7     2     4 potential-gift Flyson   Flynn          0.5 #CCCCCC90
    ##  8     8     2     5 potential-gift Flyson   Golwalsky      0.5 #CCCCCC90
    ##  9     9     2     6 potential-gift Flyson   Golwalsky      0.5 #CCCCCC90
    ## 10    10     3     4 potential-gift Flynn    Flynn          0.5 #CCCCCC90
    ## # … with 20 more rows

# Partner graph

Creating a graph showing partner pairs.

``` r
overwrite_edges <- function(old_df, new_df) {
  old_df %>%
    anti_join(new_df, by = c("from", "to")) %>%
    bind_rows(new_df)
}

partner_edges <- nibling_edges %>% 
  filter(from_fam == to_fam) %>% 
  mutate(
    rel = "sibling",
    color = "#3D9970", 
    penwidth = 1)
# Update edges that represent partner pairs
  
nibling_nodes <- create_node_df(
  n = nrow(niblings),
  type = niblings$Name,
  label = niblings$Name)
nibling_edges %>% 
  overwrite_edges(partner_edges) %>% 
  create_graph(nibling_nodes, .) %>% 
  render_graph(height = 400)
```

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %0 Pages: 1 -->
<svg width="100%" height="400" viewBox="0.00 0.00 162.67 178.47" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 174.4709)">
<title>
%0
</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-174.4709 158.6742,-174.4709 158.6742,4 -4,4"/>
<!-- 1&#45;&gt;2 --> <g id="edge25" class="edge">
<title>
1-\>2
</title>
<path fill="none" stroke="#3d9970" d="M37.1857,-54.5233C57.4697,-57.5711 91.2,-59.1798 113.6839,-58.2929"/>
<polygon fill="#3d9970" stroke="#3d9970" points="113.9567,-60.0314 118.8618,-58.0309 113.7797,-56.5359 113.9567,-60.0314"/>
</g> <!-- 1&#45;&gt;3 --> <g id="edge1" class="edge">
<title>
1-\>3
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M37.7681,-46.3207C45.6365,-43.2615 54.822,-38.718 62.6197,-34.0797"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="63.9465,-35.3159 67.2714,-31.1918 62.1004,-32.3423 63.9465,-35.3159"/>
</g> <!-- 1&#45;&gt;4 --> <g id="edge2" class="edge">
<title>
1-\>4
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M23.7023,-66.8622C31.2357,-85.9239 46.5941,-115.6801 58.5581,-134.6481"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="57.3342,-135.978 61.5199,-139.225 60.2726,-134.0765 57.3342,-135.978"/>
</g> <!-- 1&#45;&gt;5 --> <g id="edge3" class="edge">
<title>
1-\>5
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M32.2456,-62.2129C51.3165,-77.2894 87.991,-100.7241 111.6386,-113.1005"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="110.9365,-114.7069 116.1854,-115.4226 112.5284,-111.5899 110.9365,-114.7069"/>
</g> <!-- 1&#45;&gt;6 --> <g id="edge4" class="edge">
<title>
1-\>6
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M13.4393,-65.873C12.3679,-74.0654 11.9354,-83.9986 12.223,-92.8387"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="10.4928,-93.2722 12.4959,-98.1763 13.9882,-93.0935 10.4928,-93.2722"/>
</g> <!-- 2&#45;&gt;1 --> <g id="edge28" class="edge">
<title>
2-\>1
</title>
<path fill="none" stroke="#3d9970" d="M119.4078,-48.0675C99.1239,-45.0197 65.3935,-43.411 42.9097,-44.2979"/>
<polygon fill="#3d9970" stroke="#3d9970" points="42.6369,-42.5594 37.7317,-44.5599 42.8138,-46.0549 42.6369,-42.5594"/>
</g> <!-- 2&#45;&gt;3 --> <g id="edge5" class="edge">
<title>
2-\>3
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M125.2392,-39.5094C118.6145,-34.331 110.1057,-28.8046 102.2305,-24.517"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="102.675,-22.7757 97.4315,-22.0216 101.0603,-25.881 102.675,-22.7757"/>
</g> <!-- 2&#45;&gt;4 --> <g id="edge6" class="edge">
<title>
2-\>4
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M122.9352,-66.0965C110.157,-82.2119 91.9962,-110.5476 81.5922,-130.3954"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="79.9593,-129.7454 79.2463,-134.9947 83.0772,-131.3358 79.9593,-129.7454"/>
</g> <!-- 2&#45;&gt;5 --> <g id="edge7" class="edge">
<title>
2-\>5
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M129.896,-70.7856C128.6506,-79.18 128.0446,-89.4189 128.2188,-98.4447"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="126.4758,-98.6652 128.4127,-103.5958 129.9733,-98.5335 126.4758,-98.6652"/>
</g> <!-- 2&#45;&gt;6 --> <g id="edge8" class="edge">
<title>
2-\>6
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M118.9695,-57.7018C96.4791,-66.6006 58.0262,-86.5041 35.5918,-100.7107"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="34.5742,-99.2848 31.328,-103.4712 36.4763,-102.2229 34.5742,-99.2848"/>
</g> <!-- 3&#45;&gt;1 --> <g id="edge13" class="edge">
<title>
3-\>1
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M62.0247,-20.4768C54.1563,-23.536 44.9709,-28.0794 37.1731,-32.7178"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="35.8463,-31.4816 32.5214,-35.6057 37.6924,-34.4552 35.8463,-31.4816"/>
</g> <!-- 3&#45;&gt;2 --> <g id="edge17" class="edge">
<title>
3-\>2
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M91.3086,-32.2839C97.9332,-37.4623 106.4421,-42.9887 114.3173,-47.2763"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="113.8728,-49.0176 119.1163,-49.7717 115.4875,-45.9123 113.8728,-49.0176"/>
</g> <!-- 3&#45;&gt;4 --> <g id="edge26" class="edge">
<title>
3-\>4
</title>
<path fill="none" stroke="#3d9970" d="M74.3871,-35.3755C70.8222,-59.4271 68.7854,-102.9088 69.8425,-129.5827"/>
<polygon fill="#3d9970" stroke="#3d9970" points="68.0998,-129.7755 70.0956,-134.6826 71.5955,-129.602 68.0998,-129.7755"/>
</g> <!-- 3&#45;&gt;5 --> <g id="edge9" class="edge">
<title>
3-\>5
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M83.5903,-35.9392C91.0477,-54.857 106.2814,-84.3767 118.1622,-103.1871"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="116.9157,-104.4816 121.1037,-107.7257 119.8528,-102.578 116.9157,-104.4816"/>
</g> <!-- 3&#45;&gt;6 --> <g id="edge10" class="edge">
<title>
3-\>6
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M66.2433,-30.1703C53.6463,-46.0616 35.7958,-73.9666 25.5128,-93.6264"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="23.7745,-93.1843 23.0694,-98.4346 26.8947,-94.77 23.7745,-93.1843"/>
</g> <!-- 4&#45;&gt;1 --> <g id="edge14" class="edge">
<title>
4-\>1
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M70.2801,-134.4062C62.7467,-115.3445 47.3884,-85.5883 35.4243,-66.6203"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="36.6482,-65.2904 32.4626,-62.0434 33.7098,-67.1919 36.6482,-65.2904"/>
</g> <!-- 4&#45;&gt;2 --> <g id="edge18" class="edge">
<title>
4-\>2
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M87.8022,-140.1677C100.5803,-124.0524 118.7411,-95.7166 129.1452,-75.8688"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="130.7781,-76.5188 131.4911,-71.2696 127.6602,-74.9285 130.7781,-76.5188"/>
</g> <!-- 4&#45;&gt;3 --> <g id="edge29" class="edge">
<title>
4-\>3
</title>
<path fill="none" stroke="#3d9970" d="M79.5496,-135.0954C83.1145,-111.0438 85.1513,-67.5621 84.0942,-40.8882"/>
<polygon fill="#3d9970" stroke="#3d9970" points="85.8368,-40.6954 83.841,-35.7883 82.3411,-40.8689 85.8368,-40.6954"/>
</g> <!-- 4&#45;&gt;5 --> <g id="edge11" class="edge">
<title>
4-\>5
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M91.875,-149.7476C99.7,-146.5799 108.8211,-141.91 116.5534,-137.1644"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="117.8969,-138.3822 121.1644,-134.2125 116.0098,-135.4345 117.8969,-138.3822"/>
</g> <!-- 4&#45;&gt;6 --> <g id="edge12" class="edge">
<title>
4-\>6
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M62.9053,-138.0093C56.4853,-132.807 48.2475,-127.2376 40.5642,-122.854"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="41.1001,-121.1528 35.8731,-120.2918 39.4223,-124.2245 41.1001,-121.1528"/>
</g> <!-- 5&#45;&gt;1 --> <g id="edge15" class="edge">
<title>
5-\>1
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M121.2554,-107.4325C102.1845,-92.3559 65.51,-68.9212 41.8624,-56.5448"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="42.5645,-54.9384 37.3156,-54.2227 40.9726,-58.0554 42.5645,-54.9384"/>
</g> <!-- 5&#45;&gt;2 --> <g id="edge19" class="edge">
<title>
5-\>2
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M140.36,-103.8555C141.6053,-95.4612 142.2114,-85.2223 142.0371,-76.1964"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="143.7801,-75.976 141.8432,-71.0454 140.2826,-76.1077 143.7801,-75.976"/>
</g> <!-- 5&#45;&gt;3 --> <g id="edge21" class="edge">
<title>
5-\>3
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M129.8649,-102.9087C122.4075,-83.9909 107.1739,-54.4711 95.293,-35.6608"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="96.5395,-34.3662 92.3515,-31.1222 93.6024,-36.2698 96.5395,-34.3662"/>
</g> <!-- 5&#45;&gt;4 --> <g id="edge23" class="edge">
<title>
5-\>4
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M115.7698,-123.5712C107.9449,-126.7388 98.8238,-131.4087 91.0914,-136.1544"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="89.7479,-134.9366 86.4805,-139.1063 91.635,-137.8843 89.7479,-134.9366"/>
</g> <!-- 5&#45;&gt;6 --> <g id="edge27" class="edge">
<title>
5-\>6
</title>
<path fill="none" stroke="#3d9970" d="M116.2472,-115.0721C96.1131,-112.0297 62.8337,-110.414 40.6648,-111.2905"/>
<polygon fill="#3d9970" stroke="#3d9970" points="40.4645,-109.5483 35.5597,-111.5499 40.6421,-113.0438 40.4645,-109.5483"/>
</g> <!-- 6&#45;&gt;1 --> <g id="edge16" class="edge">
<title>
6-\>1
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M24.48,-98.6942C25.5514,-90.5018 25.9839,-80.5685 25.6963,-71.7285"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="27.4265,-71.295 25.4234,-66.3909 23.9311,-71.4737 27.4265,-71.295"/>
</g> <!-- 6&#45;&gt;2 --> <g id="edge20" class="edge">
<title>
6-\>2
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M35.7048,-111.8612C58.1952,-102.9624 96.648,-83.0589 119.0824,-68.8523"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="120.1001,-70.2782 123.3462,-66.0918 118.198,-67.3401 120.1001,-70.2782"/>
</g> <!-- 6&#45;&gt;3 --> <g id="edge22" class="edge">
<title>
6-\>3
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M31.6302,-103.5994C44.2272,-87.7081 62.0777,-59.8031 72.3607,-40.1433"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="74.099,-40.5854 74.8042,-35.3351 70.9788,-38.9997 74.099,-40.5854"/>
</g> <!-- 6&#45;&gt;4 --> <g id="edge24" class="edge">
<title>
6-\>4
</title>
<path fill="none" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" d="M29.1578,-130.2313C35.5778,-135.4336 43.8157,-141.003 51.499,-145.3865"/>
<polygon fill="#cccccc" fill-opacity="0.564706" stroke="#cccccc" stroke-width=".5" stroke-opacity="0.564706" points="50.9631,-147.0878 56.1901,-147.9488 52.6408,-144.0161 50.9631,-147.0878"/>
</g> <!-- 6&#45;&gt;5 --> <g id="edge30" class="edge">
<title>
6-\>5
</title>
<path fill="none" stroke="#3d9970" d="M35.3345,-121.5455C55.4686,-124.5878 88.748,-126.2036 110.9169,-125.327"/>
<polygon fill="#3d9970" stroke="#3d9970" points="111.1172,-127.0692 116.022,-125.0676 110.9396,-123.5737 111.1172,-127.0692"/>
</g> <!-- 1 --> <g id="node1" class="node">
<title>
1
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="19.9193" cy="-48.7975" rx="18" ry="18"/>
<text text-anchor="middle" x="19.9193" y="-45.7975" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Tom</text>
</g> <!-- 2 --> <g id="node2" class="node">
<title>
2
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="136.6742" cy="-53.7933" rx="18" ry="18"/>
<text text-anchor="middle" x="136.6742" y="-50.7933" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Erin</text>
</g> <!-- 3 --> <g id="node3" class="node">
<title>
3
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="79.8735" cy="-18" rx="18" ry="18"/>
<text text-anchor="middle" x="79.8735" y="-15" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Ryan</text>
</g> <!-- 4 --> <g id="node4" class="node">
<title>
4
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="74.0631" cy="-152.4709" rx="18" ry="18"/>
<text text-anchor="middle" x="74.0631" y="-149.4709" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Alli</text>
</g> <!-- 5 --> <g id="node5" class="node">
<title>
5
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="133.5817" cy="-120.8478" rx="18" ry="18"/>
<text text-anchor="middle" x="133.5817" y="-117.8478" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Gae</text>
</g> <!-- 6 --> <g id="node6" class="node">
<title>
6
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="18" cy="-115.7697" rx="18" ry="18"/>
<text text-anchor="middle" x="18" y="-112.7697" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Tim</text>
</g> </g>
</svg>

# Some useful functions

Functions to forbid partner pairs from gifting to each other and the
drawing a name from a hat function.

``` r
has_free_edge <- function(edge_df) {
  edges_left <- edge_df %>% filter(rel != "gives-to") %>% nrow()
  edges_left != 0
}

draw_secret_santa_edge <- function(edge_df, ...) {
  aes_options <- quos(...)
  
  edge_df %>%
    filter(rel != "gives-to") %>%
    sample_n(1) %>%
    mutate(!!! aes_options)
}
find_illegal_edges <- function(edge_df, edge, ...) {
  aes_options <- quos(...)
  
  outgoing <- edge_df %>%
    filter(from %in% edge$from)
  incoming <- edge_df %>%
    filter(to %in% edge$to)
  # The one edge that is not illegal is in both 
  # the incoming and outgoing sets
  to_keep <- dplyr::intersect(outgoing, incoming)
  outgoing %>% 
    bind_rows(incoming) %>% 
    anti_join(to_keep, by = c("from", "to")) %>% 
    mutate(!!! aes_options)
}

has_valid_gift_edges <- function(edge_df, indices) {
  indices <- sort(unique(indices))
  pairs <- edge_df %>% filter(rel == "gives-to")
  no_self_loop <- !any(pairs$from == pairs$to)
  exhaustive_from <- isTRUE(all.equal(sort(pairs$from), indices))
  exhaustive_to <- isTRUE(all.equal(sort(pairs$to), indices))
  all(no_self_loop, exhaustive_from, exhaustive_to)
}

draw_edges_from_hat <- function(edge_df, ...) {
  aes_options <- quos(...)
  raw_edge_df <- edge_df
  indices <- unique(c(raw_edge_df$from, raw_edge_df$to))
  
  while (has_free_edge(edge_df)) {
    pick <- edge_df %>% 
      draw_secret_santa_edge(!!! aes_options) %>% 
      mutate(rel = "gives-to")
    
    illegal_edges <- edge_df %>%
      find_illegal_edges(pick)
    edge_df <- edge_df %>%
      overwrite_edges(pick) %>% 
      anti_join(illegal_edges, by = "id") 
  }
  if (!has_valid_gift_edges(edge_df, indices)) {
    warning(call. = FALSE, "Invalid drawing. Trying again.")
    edge_df <- Recall(raw_edge_df, !!! aes_options)
  }
  
  edge_df
}
```

# The draw!

Drawing names from a hat, forbidding partners to give/receive gifts from
each other.

``` r
nibling_edges %>% 
  filter(rel != "partner") %>% 
  draw_edges_from_hat(color = "#FF4136") %>% 
  create_graph(nibling_nodes, .) %>% 
  render_graph(height = 500)
```

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %0 Pages: 1 -->
<svg width="100%" height="500" viewBox="0.00 0.00 259.54 283.85" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 279.8538)">
<title>
%0
</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-279.8538 255.5386,-279.8538 255.5386,4 -4,4"/>
<!-- 1&#45;&gt;5 --> <g id="edge2" class="edge">
<title>
1-\>5
</title>
<path fill="none" stroke="#ff4136" stroke-width=".5" d="M148.061,-28.0118C165.7744,-39.5975 194.9699,-58.6933 214.2281,-71.2894"/>
<polygon fill="#ff4136" stroke="#ff4136" stroke-width=".5" points="213.2754,-72.7573 218.4178,-74.0297 215.1913,-69.8282 213.2754,-72.7573"/>
</g> <!-- 2&#45;&gt;4 --> <g id="edge5" class="edge">
<title>
2-\>4
</title>
<path fill="none" stroke="#ff4136" stroke-width=".5" d="M210.1498,-212.2907C191.2054,-221.7327 159.981,-237.2951 139.3845,-247.5605"/>
<polygon fill="#ff4136" stroke="#ff4136" stroke-width=".5" points="138.598,-245.9971 134.9036,-249.7937 140.1592,-249.1296 138.598,-245.9971"/>
</g> <!-- 3&#45;&gt;1 --> <g id="edge1" class="edge">
<title>
3-\>1
</title>
<path fill="none" stroke="#ff4136" stroke-width=".5" d="M41.2999,-63.4668C60.2518,-54.0447 91.4886,-38.5153 112.0932,-28.2716"/>
<polygon fill="#ff4136" stroke="#ff4136" stroke-width=".5" points="112.8777,-29.836 116.5759,-26.043 111.3196,-26.7019 112.8777,-29.836"/>
</g> <!-- 4&#45;&gt;6 --> <g id="edge3" class="edge">
<title>
4-\>6
</title>
<path fill="none" stroke="#ff4136" stroke-width=".5" d="M103.4329,-247.8258C85.7288,-236.2214 56.5486,-217.0948 37.3005,-204.4784"/>
<polygon fill="#ff4136" stroke="#ff4136" stroke-width=".5" points="38.2541,-203.011 33.1129,-201.7336 36.3353,-205.9383 38.2541,-203.011"/>
</g> <!-- 5&#45;&gt;2 --> <g id="edge6" class="edge">
<title>
5-\>2
</title>
<path fill="none" stroke="#ff4136" stroke-width=".5" d="M232.488,-101.9166C231.2579,-122.9856 229.2181,-157.9267 227.8714,-180.9929"/>
<polygon fill="#ff4136" stroke="#ff4136" stroke-width=".5" points="226.1229,-180.918 227.5784,-186.0115 229.617,-181.1221 226.1229,-180.918"/>
</g> <!-- 6&#45;&gt;3 --> <g id="edge4" class="edge">
<title>
6-\>3
</title>
<path fill="none" stroke="#ff4136" stroke-width=".5" d="M19.0364,-173.8297C20.2497,-152.7595 22.2619,-117.8163 23.5902,-94.7487"/>
<polygon fill="#ff4136" stroke="#ff4136" stroke-width=".5" points="25.3388,-94.8222 23.8792,-89.7298 21.8446,-94.6209 25.3388,-94.8222"/>
</g> <!-- 1 --> <g id="node1" class="node">
<title>
1
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="132.7539" cy="-18" rx="18" ry="18"/>
<text text-anchor="middle" x="132.7539" y="-15" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Tom</text>
</g> <!-- 2 --> <g id="node2" class="node">
<title>
2
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="226.5206" cy="-204.1315" rx="18" ry="18"/>
<text text-anchor="middle" x="226.5206" y="-201.1315" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Erin</text>
</g> <!-- 3 --> <g id="node3" class="node">
<title>
3
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="24.9227" cy="-71.6088" rx="18" ry="18"/>
<text text-anchor="middle" x="24.9227" y="-68.6088" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Ryan</text>
</g> <!-- 4 --> <g id="node4" class="node">
<title>
4
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="118.7319" cy="-257.8538" rx="18" ry="18"/>
<text text-anchor="middle" x="118.7319" y="-254.8538" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Alli</text>
</g> <!-- 5 --> <g id="node5" class="node">
<title>
5
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="233.5386" cy="-83.9197" rx="18" ry="18"/>
<text text-anchor="middle" x="233.5386" y="-80.9197" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Gae</text>
</g> <!-- 6 --> <g id="node6" class="node">
<title>
6
</title>
<ellipse fill="#f0f8ff" stroke="#b3b3b3" cx="18" cy="-191.8276" rx="18" ry="18"/>
<text text-anchor="middle" x="18" y="-188.8276" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Tim</text>
</g> </g>
</svg>
